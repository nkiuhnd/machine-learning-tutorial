<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆä¸­ç”ŸK-å‡å€¼èšç±»å­¦ä¹ å·¥å…·</title>
    <!-- ä½¿ç”¨æœ¬åœ°Chart.jsæˆ–å¤‡ç”¨CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        // å¦‚æœChart.jsåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ
        if (typeof Chart === 'undefined') {
            console.warn('Chart.jsåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ');
            // åˆ›å»ºä¸€ä¸ªç®€å•çš„å›¾è¡¨æ¨¡æ‹Ÿå¯¹è±¡
            window.Chart = function(ctx, config) {
                this.data = config.data;
                this.options = config.options;
                this.update = function() {
                    console.log('å›¾è¡¨æ›´æ–°ï¼ˆæ¨¡æ‹Ÿï¼‰');
                };
            };
        }
    </script>
    <script src="../js/utils.js"></script>
    
    <link rel="stylesheet" href="../styles/main.css">
</head>
<body>
    <div class="container">
        
        <!-- å¯¼èˆªæ  -->
        <nav class="nav-bar">
            <ul class="nav-links">
                <li><a href="../index-modern.html">ğŸ  è¿”å›é¦–é¡µ</a></li>
                <li><a href="#theory">ğŸ“š ç†è®º</a></li>
                <li><a href="#interactive">ğŸ® äº’åŠ¨</a></li>
                <li><a href="#practice">ğŸ’¡ ç»ƒä¹ </a></li>
            </ul>
        </nav>
    
        <div class="header">
            <h1>ğŸ›’ K-å‡å€¼èšç±»å­¦ä¹ </h1>
            <p>æŠŠç›¸ä¼¼çš„å•†å“åˆ†åˆ°åŒä¸€ç»„</p>
        </div>
        
        <div class="section">
            <h2>ğŸ“Š ç¬¬ä¸€æ­¥ï¼šè§‚å¯Ÿå•†å“æ•°æ®</h2>
            <p>æˆ‘ä»¬æ¥çœ‹çœ‹è¶…å¸‚é‡Œä¸åŒå•†å“çš„ä»·æ ¼å’Œé‡é‡ï¼š</p>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>å•†å“</th>
                        <th>ä»·æ ¼(å…ƒ)</th>
                        <th>é‡é‡(å…‹)</th>
                        <th>åˆå§‹åˆ†ç»„</th>
                    </tr>
                </thead>
                <tbody id="dataTable">
                    <tr><td>è‹¹æœ</td><td>8</td><td>200</td><td>?</td></tr>
                    <tr><td>æ©™å­</td><td>6</td><td>150</td><td>?</td></tr>
                    <tr><td>ç‰›å¥¶</td><td>15</td><td>500</td><td>?</td></tr>
                    <tr><td>é¢åŒ…</td><td>12</td><td>300</td><td>?</td></tr>
                    <tr><td>å·§å…‹åŠ›</td><td>25</td><td>100</td><td>?</td></tr>
                    <tr><td>è–¯ç‰‡</td><td>18</td><td>150</td><td>?</td></tr>
                </tbody>
            </table>
        </div>
        
        <div class="section">
            <h2>ğŸ¤” æ€è€ƒä¸æ¢ç´¢</h2>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #667eea;">
                <p><strong>ä»€ä¹ˆæ˜¯K-å‡å€¼èšç±»ï¼Ÿ</strong></p>
                <p>K-å‡å€¼èšç±»æ˜¯ä¸€ç§æŠŠç›¸ä¼¼æ•°æ®åˆ†åˆ°åŒä¸€ç»„çš„ç®—æ³•ã€‚å°±åƒè¶…å¸‚æŠŠç›¸ä¼¼çš„å•†å“æ”¾åœ¨ä¸€èµ·ï¼š</p>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li>ğŸ æ°´æœåŒºï¼šè‹¹æœã€æ©™å­ã€é¦™è•‰...</li>
                    <li>ğŸ¥› å¥¶åˆ¶å“åŒºï¼šç‰›å¥¶ã€é…¸å¥¶ã€å¥¶é…ª...</li>
                    <li>ğŸ« é›¶é£ŸåŒºï¼šå·§å…‹åŠ›ã€è–¯ç‰‡ã€é¥¼å¹²...</li>
                </ul>
                
                <p><strong>K-å‡å€¼ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³ï¼š</strong></p>
                <ol style="margin: 10px 0; padding-left: 20px;">
                    <li>ğŸ¯ å…ˆé€‰Kä¸ª"ä¸­å¿ƒç‚¹"ï¼ˆæ¯”å¦‚3ä¸ªåŒºåŸŸï¼‰</li>
                    <li>ğŸ“ è®¡ç®—æ¯ä¸ªå•†å“åˆ°å„ä¸ªä¸­å¿ƒçš„è·ç¦»</li>
                    <li>ğŸ·ï¸ æŠŠå•†å“åˆ†åˆ°æœ€è¿‘çš„ä¸­å¿ƒ</li>
                    <li>ğŸ”„ é‡æ–°è®¡ç®—æ¯ä¸ªç»„çš„ä¸­å¿ƒä½ç½®</li>
                    <li>ğŸ”„ é‡å¤ç›´åˆ°ä¸­å¿ƒä¸å†ç§»åŠ¨</li>
                </ol>
                
                <p><strong>ä¸ºä»€ä¹ˆè¦ç”¨èšç±»ï¼Ÿ</strong></p>
                <p>å¸®åŠ©æˆ‘ä»¬å‘ç°æ•°æ®ä¸­çš„è§„å¾‹ï¼ŒæŠŠç›¸ä¼¼çš„ä¸œè¥¿å½’ç±»ï¼Œè®©ç®¡ç†æ›´ç®€å•ï¼</p>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ® ç¬¬äºŒæ­¥ï¼šåŠ¨æ‰‹å®éªŒ</h2>
            <div class="controls">
                <div class="input-group">
                    <label>èšç±»æ•°é‡ Kï¼š</label>
                    <select id="kValue">
                        <option value="2">2ç»„</option>
                        <option value="3" selected>3ç»„</option>
                        <option value="4">4ç»„</option>
                    </select>
                </div>
                
                <button onclick="generateRandomData()">ğŸ² ç”Ÿæˆå•†å“æ•°æ®</button>
                <button onclick="initializeCentroids()">ğŸ¯ é€‰æ‹©ä¸­å¿ƒç‚¹</button>
                <button onclick="runOneStep()">â­ï¸ æ‰§è¡Œä¸€æ­¥</button>
                <button onclick="runFullClustering()">ğŸ”„ å®Œæ•´èšç±»</button>
                <button onclick="resetClustering()">ğŸ”„ é‡ç½®</button>
            </div>
            
            <div class="step-indicator">
                <div class="step" id="step1" onclick="showStep(1)">1. é€‰æ‹©ä¸­å¿ƒ</div>
                <div class="step" id="step2" onclick="showStep(2)">2. åˆ†é…å•†å“</div>
                <div class="step" id="step3" onclick="showStep(3)">3. æ›´æ–°ä¸­å¿ƒ</div>
                <div class="step" id="step4" onclick="showStep(4)">4. å®Œæˆèšç±»</div>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ“ˆ ç¬¬ä¸‰æ­¥ï¼šå¯è§†åŒ–èšç±»è¿‡ç¨‹</h2>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #ff6b6b;"></div>
                    <span>èšç±»1</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4ecdc4;"></div>
                    <span>èšç±»2</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #45b7d1;"></div>
                    <span>èšç±»3</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #96ceb4;"></div>
                    <span>èšç±»4</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #000; border: 2px solid #333;"></div>
                    <span>ä¸­å¿ƒç‚¹</span>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="clusterChart"></canvas>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ“Š èšç±»ç»“æœåˆ†æ</h2>
            <div class="cluster-info" id="clusterInfo">
                <div class="cluster-card cluster-0">
                    <h4>èšç±»1</h4>
                    <p>å•†å“æ•°é‡ï¼š<span id="count1">0</span></p>
                    <p>å¹³å‡ä»·æ ¼ï¼š<span id="avgPrice1">-</span>å…ƒ</p>
                    <p>å¹³å‡é‡é‡ï¼š<span id="avgWeight1">-</span>å…‹</p>
                    <p>å•†å“ç±»å‹ï¼š<span id="type1">-</span></p>
                </div>
                <div class="cluster-card cluster-1">
                    <h4>èšç±»2</h4>
                    <p>å•†å“æ•°é‡ï¼š<span id="count2">0</span></p>
                    <p>å¹³å‡ä»·æ ¼ï¼š<span id="avgPrice2">-</span>å…ƒ</p>
                    <p>å¹³å‡é‡é‡ï¼š<span id="avgWeight2">-</span>å…‹</p>
                    <p>å•†å“ç±»å‹ï¼š<span id="type2">-</span></p>
                </div>
                <div class="cluster-card cluster-2">
                    <h4>èšç±»3</h4>
                    <p>å•†å“æ•°é‡ï¼š<span id="count3">0</span></p>
                    <p>å¹³å‡ä»·æ ¼ï¼š<span id="avgPrice3">-</span>å…ƒ</p>
                    <p>å¹³å‡é‡é‡ï¼š<span id="avgWeight3">-</span>å…‹</p>
                    <p>å•†å“ç±»å‹ï¼š<span id="type3">-</span></p>
                </div>
            </div>
            
            <div class="distance-info" id="distanceInfo">
                <h4>è·ç¦»è®¡ç®—è¯¦æƒ…</h4>
                <p>ç‚¹å‡»"æ‰§è¡Œä¸€æ­¥"æŸ¥çœ‹æ¯ä¸ªæ­¥éª¤çš„è·ç¦»è®¡ç®—</p>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ¯ ç¬¬å››æ­¥ï¼šå®æ—¶é¢„æµ‹</h2>
            <div class="controls" style="flex-direction: column; align-items: stretch;">
                <div class="input-group" style="margin-bottom: 15px;">
                    <label>è¾“å…¥æ–°å•†å“æ•°æ®ï¼š</label>
                    <input type="number" id="newPrice" placeholder="ä»·æ ¼(å…ƒ)" min="0" max="100" value="20">
                    <input type="number" id="newWeight" placeholder="é‡é‡(å…‹)" min="0" max="1000" value="250">
                    <button onclick="predictCluster()">ğŸ” é¢„æµ‹åˆ†ç»„</button>
                </div>
            </div>
            
            <div class="prediction-result" id="predictionResult">
                è¾“å…¥å•†å“æ•°æ®ï¼Œç‚¹å‡»"é¢„æµ‹åˆ†ç»„"æŸ¥çœ‹ç»“æœ
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ¤– å°ç»“ï¼šK-å‡å€¼èšç±»çš„åº”ç”¨</h2>
            <div style="background: #d1ecf1; padding: 15px; border-radius: 8px; border-left: 5px solid #17a2b8;">
                <h3>ğŸ§  K-å‡å€¼èšç±»åœ¨ç”Ÿæ´»ä¸­çš„åº”ç”¨</h3>
                <p><strong>ğŸª è¶…å¸‚å•†å“åˆ†ç±»ï¼š</strong>æŠŠç›¸ä¼¼çš„å•†å“æ”¾åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿é¡¾å®¢è´­ç‰©</p>
                <p><strong>ğŸ‘¥ å®¢æˆ·åˆ†ç¾¤ï¼š</strong>æ ¹æ®è´­ä¹°è¡Œä¸ºï¼ŒæŠŠå®¢æˆ·åˆ†ä¸º"é«˜ä»·å€¼"ã€"æ½œåŠ›"ã€"æ™®é€š"ç­‰ç¾¤ä½“</p>
                <p><strong>ğŸ“± æ¨èç³»ç»Ÿï¼š</strong>æŠŠå–œå¥½ç›¸ä¼¼çš„ç”¨æˆ·åˆ†åˆ°ä¸€ç»„ï¼Œæ¨èç›¸ä¼¼å•†å“</p>
                <p><strong>ğŸ¥ åŒ»ç–—è¯Šæ–­ï¼š</strong>æ ¹æ®ç—‡çŠ¶ç›¸ä¼¼æ€§ï¼ŒæŠŠç—…äººåˆ†ç»„è¿›è¡Œé’ˆå¯¹æ€§æ²»ç–—</p>
                
                <h3>ğŸ¯ K-å‡å€¼ç®—æ³•çš„ä¼˜åŠ¿</h3>
                <ol>
                    <li>ğŸš€ è®¡ç®—ç®€å•å¿«é€Ÿ</li>
                    <li>ğŸ“Š ç»“æœç›´è§‚æ˜“æ‡‚</li>
                    <li>ğŸ¯ å¯ä»¥å¤„ç†å¤§æ•°æ®</li>
                    <li>ğŸ”§ å‚æ•°å°‘ï¼Œå®¹æ˜“è°ƒä¼˜</li>
                </ol>
                
                <h3>âš ï¸ æ³¨æ„äº‹é¡¹</h3>
                <ul>
                    <li>éœ€è¦æå‰çŸ¥é“èšç±»æ•°é‡K</li>
                    <li>å¯¹åˆå§‹ä¸­å¿ƒç‚¹æ•æ„Ÿ</li>
                    <li>é€‚åˆçƒå½¢åˆ†å¸ƒçš„æ•°æ®</li>
                    <li>ä¸åŒç‰¹å¾çš„é‡è¦æ€§éœ€è¦å¹³è¡¡</li>
                </ul>
                
                <h3>ğŸ’¡ ç®—æ³•æµç¨‹æ€»ç»“</h3>
                <p><strong>è¾“å…¥ï¼š</strong>æ•°æ®ç‚¹ + èšç±»æ•°é‡K</p>
                <p><strong>è¾“å‡ºï¼š</strong>Kä¸ªèšç±» + æ¯ä¸ªèšç±»çš„ä¸­å¿ƒç‚¹</p>
                <p><strong>æ ¸å¿ƒï¼š</strong>æœ€å°åŒ–æ¯ä¸ªç‚¹åˆ°å…¶ä¸­å¿ƒç‚¹çš„è·ç¦»å¹³æ–¹å’Œ</p>
            </div>
        </div>
    </div>

    <script>
        // K-å‡å€¼èšç±»ä¸“ç”¨å˜é‡ï¼Œé¿å…ä¸utils.jsä¸­çš„chartå†²çª
        let kmeansChart;
        let dataPoints = [];
        let centroids = [];
        let clusters = [];
        let currentStep = 0;
        let iteration = 0;
        let isClusteringComplete = false;

        const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4'];
        const productTypes = ['æ°´æœç±»', 'å¥¶åˆ¶å“', 'é›¶é£Ÿç±»', 'æ—¥ç”¨å“'];

        function initChart() {
            const ctx = document.getElementById('clusterChart').getContext('2d');
            
            kmeansChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'å•†å“',
                            data: [],
                            backgroundColor: '#ccc',
                            borderColor: '#ccc',
                            pointRadius: 6
                        },
                        {
                            label: 'ä¸­å¿ƒç‚¹',
                            data: [],
                            backgroundColor: '#000',
                            borderColor: '#000',
                            pointRadius: 10,
                            pointStyle: 'triangle'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: { display: true, text: 'ä»·æ ¼(å…ƒ)' },
                            min: 0,
                            max: 50
                        },
                        y: {
                            title: { display: true, text: 'é‡é‡(å…‹)' },
                            min: 0,
                            max: 600
                        }
                    },
                    plugins: {
                        title: { display: true, text: 'å•†å“èšç±»å›¾' }
                    }
                }
            });
        }

        function generateRandomData() {
            dataPoints = [];
            
            // ç”Ÿæˆ3ä¸ªèšç±»çš„å•†å“æ•°æ®
            const centers = [
                {x: 8, y: 200},   // æ°´æœç±»ï¼šä»·æ ¼ä½ï¼Œé‡é‡ä¸­ç­‰
                {x: 15, y: 400},  // å¥¶åˆ¶å“ï¼šä»·æ ¼ä¸­ç­‰ï¼Œé‡é‡å¤§
                {x: 20, y: 150}   // é›¶é£Ÿç±»ï¼šä»·æ ¼é«˜ï¼Œé‡é‡å°
            ];
            
            const productNames = [
                'è‹¹æœ', 'æ©™å­', 'é¦™è•‰', 'è‘¡è„', 'æ¢¨å­', 'æ¡ƒå­',
                'ç‰›å¥¶', 'é…¸å¥¶', 'å¥¶é…ª', 'é»„æ²¹', 'å¥¶æ²¹', 'å¥¶ç²‰',
                'å·§å…‹åŠ›', 'è–¯ç‰‡', 'é¥¼å¹²', 'ç³–æœ', 'åšæœ', 'æœå¹²'
            ];
            
            for (let i = 0; i < 18; i++) {
                const cluster = Math.floor(i / 6);
                const x = centers[cluster].x + (Math.random() - 0.5) * 8;
                const y = centers[cluster].y + (Math.random() - 0.5) * 100;
                
                dataPoints.push({
                    x: Math.max(0, Math.min(50, x)),
                    y: Math.max(0, Math.min(600, y)),
                    name: productNames[i],
                    cluster: null
                });
            }
            
            updateChart();
            updateDataTable();
            resetClustering();
        }

        function updateChart() {
            if (!kmeansChart) return;
            
            const k = parseInt(document.getElementById('kValue').value);
            
            // æ›´æ–°æ•°æ®ç‚¹
            const datasets = [];
            
            // ä¸ºæ¯ä¸ªèšç±»åˆ›å»ºæ•°æ®é›†
            for (let i = 0; i < k; i++) {
                const clusterData = dataPoints.filter(p => p.cluster === i);
                datasets.push({
                    label: `èšç±»${i+1}`,
                    data: clusterData,
                    backgroundColor: colors[i],
                    borderColor: colors[i],
                    pointRadius: 6
                });
            }
            
            // æœªåˆ†é…çš„ç‚¹
            const unassigned = dataPoints.filter(p => p.cluster === null);
            if (unassigned.length > 0) {
                datasets.push({
                    label: 'æœªåˆ†ç»„',
                    data: unassigned,
                    backgroundColor: '#ccc',
                    borderColor: '#ccc',
                    pointRadius: 6
                });
            }
            
            // ä¸­å¿ƒç‚¹
            if (centroids.length > 0) {
                datasets.push({
                    label: 'ä¸­å¿ƒç‚¹',
                    data: centroids.map((c, i) => ({x: c.x, y: c.y})),
                    backgroundColor: '#000',
                    borderColor: '#000',
                    pointRadius: 10,
                    pointStyle: 'triangle'
                });
            }
            
            kmeansChart.data.datasets = datasets;
            kmeansChart.update();
        }

        function initializeCentroids() {
            const k = parseInt(document.getElementById('kValue').value);
            
            if (dataPoints.length < k) {
                alert(`éœ€è¦è‡³å°‘${k}ä¸ªå•†å“æ‰èƒ½åˆ†æˆ${k}ç»„ï¼`);
                return;
            }
            
            centroids = [];
            for (let i = 0; i < k; i++) {
                centroids.push({
                    x: 5 + Math.random() * 30,
                    y: 100 + Math.random() * 300
                });
            }
            
            resetClustering();
            updateChart();
            showStep(1);
            
            document.getElementById('distanceInfo').innerHTML = 
                `<h4>ğŸ¯ ä¸­å¿ƒç‚¹å·²åˆå§‹åŒ–</h4>` +
                centroids.map((c, i) => 
                    `<p>ä¸­å¿ƒç‚¹${i+1}: ä»·æ ¼${c.x.toFixed(1)}å…ƒï¼Œé‡é‡${c.y.toFixed(1)}å…‹</p>`
                ).join('');
        }

        function assignClusters() {
            clusters = Array(centroids.length).fill(null).map(() => []);
            
            dataPoints.forEach(point => {
                let minDist = Infinity;
                let closestCluster = 0;
                
                centroids.forEach((centroid, i) => {
                    const dist = Math.sqrt(
                        Math.pow(point.x - centroid.x, 2) + 
                        Math.pow(point.y - centroid.y, 2)
                    );
                    
                    if (dist < minDist) {
                        minDist = dist;
                        closestCluster = i;
                    }
                });
                
                point.cluster = closestCluster;
                clusters[closestCluster].push(point);
            });
            
            updateChart();
            updateClusterInfo();
            showStep(2);
            
            let distanceDetails = '<h4>ğŸ“ è·ç¦»è®¡ç®—è¯¦æƒ…</h4>';
            dataPoints.forEach((point, idx) => {
                const distances = centroids.map((c, i) => 
                    Math.sqrt(Math.pow(point.x - c.x, 2) + Math.pow(point.y - c.y, 2))
                );
                const minDist = Math.min(...distances);
                const cluster = distances.indexOf(minDist);
                
                distanceDetails += 
                    `<p>${point.name}(${point.x.toFixed(1)}å…ƒ, ${point.y.toFixed(1)}å…‹) â†’ ` +
                    `åˆ†é…åˆ°èšç±»${cluster+1}ï¼Œè·ç¦»=${minDist.toFixed(1)}</p>`;
            });
            
            document.getElementById('distanceInfo').innerHTML = distanceDetails;
        }

        function updateCentroids() {
            const newCentroids = [];
            
            clusters.forEach((cluster, i) => {
                if (cluster.length > 0) {
                    const avgX = cluster.reduce((sum, p) => sum + p.x, 0) / cluster.length;
                    const avgY = cluster.reduce((sum, p) => sum + p.y, 0) / cluster.length;
                    newCentroids.push({x: avgX, y: avgY});
                } else {
                    newCentroids.push(centroids[i]);
                }
            });
            
            centroids = newCentroids;
            updateChart();
            showStep(3);
            
            document.getElementById('distanceInfo').innerHTML = 
                '<h4>ğŸ”„ ä¸­å¿ƒç‚¹å·²æ›´æ–°</h4>' +
                centroids.map((c, i) => 
                    `<p>æ–°ä¸­å¿ƒç‚¹${i+1}: ä»·æ ¼${c.x.toFixed(1)}å…ƒï¼Œé‡é‡${c.y.toFixed(1)}å…‹</p>`
                ).join('');
        }

        function runOneStep() {
            if (centroids.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©ä¸­å¿ƒç‚¹ï¼');
                return;
            }
            
            if (currentStep === 0) {
                assignClusters();
                currentStep = 1;
            } else if (currentStep === 1) {
                updateCentroids();
                currentStep = 2;
                iteration++;
            } else {
                assignClusters();
                currentStep = 1;
                iteration++;
            }
            
            // æ£€æŸ¥æ˜¯å¦æ”¶æ•›
            if (iteration > 5) {
                showStep(4);
                isClusteringComplete = true;
                document.getElementById('distanceInfo').innerHTML = 
                    `<h4>âœ… èšç±»å®Œæˆï¼</h4>` +
                    `<p>å…±è¿›è¡Œäº†${iteration}æ¬¡è¿­ä»£</p>` +
                    centroids.map((c, i) => 
                        `<p>æœ€ç»ˆä¸­å¿ƒç‚¹${i+1}: ä»·æ ¼${c.x.toFixed(1)}å…ƒï¼Œé‡é‡${c.y.toFixed(1)}å…‹</p>`
                    ).join('');
            }
        }

        function runFullClustering() {
            if (centroids.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©ä¸­å¿ƒç‚¹ï¼');
                return;
            }
            
            let maxIterations = 10;
            let changed = true;
            iteration = 0;
            
            while (changed && iteration < maxIterations) {
                const oldCentroids = JSON.parse(JSON.stringify(centroids));
                
                assignClusters();
                updateCentroids();
                
                changed = !centroids.every((c, i) => 
                    Math.abs(c.x - oldCentroids[i].x) < 0.1 && 
                    Math.abs(c.y - oldCentroids[i].y) < 0.1
                );
                
                iteration++;
            }
            
            showStep(4);
            isClusteringComplete = true;
            
            document.getElementById('distanceInfo').innerHTML = 
                `<h4>âœ… èšç±»å®Œæˆï¼</h4>` +
                `<p>å…±è¿›è¡Œäº†${iteration}æ¬¡è¿­ä»£</p>` +
                centroids.map((c, i) => 
                    `<p>æœ€ç»ˆä¸­å¿ƒç‚¹${i+1}: ä»·æ ¼${c.x.toFixed(1)}å…ƒï¼Œé‡é‡${c.y.toFixed(1)}å…‹</p>`
                ).join('');
        }

        function showStep(step) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById(`step${step}`).classList.add('active');
        }

        function predictCluster() {
            if (centroids.length === 0) {
                alert('è¯·å…ˆè¿è¡Œèšç±»ç®—æ³•ï¼');
                return;
            }
            
            const price = parseFloat(document.getElementById('newPrice').value);
            const weight = parseFloat(document.getElementById('newWeight').value);
            
            if (isNaN(price) || isNaN(weight)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å€¼ï¼');
                return;
            }
            
            let minDist = Infinity;
            let closestCluster = 0;
            
            centroids.forEach((centroid, i) => {
                const dist = Math.sqrt(
                    Math.pow(price - centroid.x, 2) + 
                    Math.pow(weight - centroid.y, 2)
                );
                
                if (dist < minDist) {
                    minDist = dist;
                    closestCluster = i;
                }
            });
            
            document.getElementById('predictionResult').innerHTML = 
                `ğŸ¯ é¢„æµ‹ç»“æœï¼šè¿™ä¸ªå•†å“å±äº<strong>èšç±»${closestCluster+1}</strong><br>` +
                `ğŸ“Š ä»·æ ¼${price}å…ƒï¼Œé‡é‡${weight}å…‹ â†’ è·ç¦»ä¸­å¿ƒç‚¹${minDist.toFixed(1)}<br>` +
                `ğŸ¯ è¯¥èšç±»å¹³å‡ç‰¹å¾ï¼šä»·æ ¼${centroids[closestCluster].x.toFixed(1)}å…ƒï¼Œé‡é‡${centroids[closestCluster].y.toFixed(1)}å…‹`;
        }

        function updateClusterInfo() {
            const k = parseInt(document.getElementById('kValue').value);
            
            for (let i = 0; i < k; i++) {
                const cluster = clusters[i] || [];
                const count = cluster.length;
                const avgPrice = count > 0 ? 
                    cluster.reduce((sum, p) => sum + p.x, 0) / count : 0;
                const avgWeight = count > 0 ? 
                    cluster.reduce((sum, p) => sum + p.y, 0) / count : 0;
                
                // åˆ¤æ–­å•†å“ç±»å‹
                let type = 'æœªçŸ¥';
                if (avgPrice < 12 && avgWeight < 300) type = 'æ°´æœç±»';
                else if (avgPrice < 20 && avgWeight > 300) type = 'å¥¶åˆ¶å“';
                else if (avgPrice > 15 && avgWeight < 200) type = 'é›¶é£Ÿç±»';
                else type = 'æ—¥ç”¨å“';
                
                document.getElementById(`count${i+1}`).textContent = count;
                document.getElementById(`avgPrice${i+1}`).textContent = avgPrice.toFixed(1);
                document.getElementById(`avgWeight${i+1}`).textContent = avgWeight.toFixed(1);
                document.getElementById(`type${i+1}`).textContent = type;
            }
        }

        function updateDataTable() {
            const tbody = document.getElementById('dataTable');
            tbody.innerHTML = '';
            
            dataPoints.forEach((point, idx) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${point.name}</td>
                    <td>${point.x.toFixed(1)}</td>
                    <td>${point.y.toFixed(1)}</td>
                    <td>${point.cluster !== null ? `èšç±»${point.cluster+1}` : '?'}</td>
                `;
            });
        }

        function resetClustering() {
            clusters = [];
            dataPoints.forEach(p => p.cluster = null);
            currentStep = 0;
            iteration = 0;
            isClusteringComplete = false;
            
            updateChart();
            updateClusterInfo();
            
            document.getElementById('distanceInfo').innerHTML = 
                '<h4>è·ç¦»è®¡ç®—è¯¦æƒ…</h4><p>ç‚¹å‡»"æ‰§è¡Œä¸€æ­¥"æŸ¥çœ‹æ¯ä¸ªæ­¥éª¤çš„è·ç¦»è®¡ç®—</p>';
            document.getElementById('predictionResult').innerHTML = 
                'è¾“å…¥å•†å“æ•°æ®ï¼Œç‚¹å‡»"é¢„æµ‹åˆ†ç»„"æŸ¥çœ‹ç»“æœ';
            
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            initChart();
            generateRandomData();
        };
    </script>
</body>
</html>