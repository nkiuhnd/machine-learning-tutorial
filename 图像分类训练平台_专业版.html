<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ ÂõæÂÉèÂàÜÁ±ªËÆ≠ÁªÉÂπ≥Âè∞</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@latest/dist/mobilenet.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #ff6b6b, #ff8e53);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .main-content {
            padding: 30px;
        }
        
        .step-section {
            margin: 30px 0;
            padding: 25px;
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            background: #fafafa;
        }
        
        .step-title {
            color: #333;
            font-size: 1.5em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .step-number {
            background: #ff6b6b;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .classes-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .class-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .class-card:hover {
            border-color: #ff6b6b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .class-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .class-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            border: none;
            border-bottom: 2px solid #ff6b6b;
            padding: 5px;
            width: 150px;
            text-align: center;
        }
        
        .image-stats {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }
        
        .image-upload {
            border: 3px dashed #ccc;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: #f9f9f9;
        }
        
        .image-upload:hover {
            border-color: #ff6b6b;
            background: #fff5f5;
        }
        
        .image-upload.dragover {
            border-color: #ff6b6b;
            background: #ffe0e0;
        }
        
        .upload-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .preview-item {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #eee;
            transition: transform 0.2s;
        }
        
        .preview-item:hover {
            transform: scale(1.1);
        }
        
        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .remove-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .training-section {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .train-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }
        
        .train-btn:hover:not(:disabled) {
            background: #ff5252;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .train-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .progress-container {
            margin: 20px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #4CAF50;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .training-details {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: left;
        }
        
        .prediction-section {
            display: none;
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .prediction-result {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin: 30px 0;
        }
        
        .result-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            text-align: center;
            min-width: 180px;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }
        
        .result-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.2);
        }
        
        .result-card.winner {
            border: 3px solid #FFD700;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
            50% { box-shadow: 0 8px 25px rgba(255,215,0,0.4); }
            100% { box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        }
        
        .result-card h4 {
            font-size: 1.3em;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .result-card p {
            font-size: 1.5em;
            font-weight: bold;
            color: #FFD700;
        }
        
        .result-card.winner p {
            color: #FFD700;
            font-size: 1.8em;
        }
        
        .confidence-bar {
            width: 120px;
            height: 12px;
            background: rgba(255,255,255,0.3);
            border-radius: 6px;
            overflow: hidden;
            margin: 15px auto;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFD700, #FFA500);
            transition: width 0.5s ease;
            border-radius: 6px;
        }
        
        .file-input {
            display: none;
        }
        
        .status-message {
            margin: 10px 0;
            font-size: 1.1em;
            font-weight: bold;
        }
        
        .add-class-btn {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px 0;
            font-size: 1em;
        }
        
        .remove-class-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8em;
        }
        
        .test-upload {
            max-width: 400px;
            margin: 20px auto;
        }
        
        .test-preview {
            width: 250px;
            height: 250px;
            margin: 20px auto;
            border: 3px solid #667eea;
            border-radius: 15px;
            display: none;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(102,126,234,0.3);
            transition: all 0.3s ease;
        }
        
        .test-preview:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 35px rgba(102,126,234,0.4);
        }
        
        .test-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .model-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-3px);
        }
        
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .metric-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .tips {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .tips h4 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .tips ul {
            color: #856404;
            padding-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ ÂõæÂÉèÂàÜÁ±ªËÆ≠ÁªÉÂπ≥Âè∞‰∏ì‰∏öÁâà</h1>
           
        </div>
        
        <div class="main-content">
            <!-- ËÆ≠ÁªÉÊèêÁ§∫ -->
            <div class="tips">
                <h4>üí° ËÆ≠ÁªÉÂ∞èË¥¥Â£´</h4>
                <div class="training-guide">
                    <h3 style="color: #007bff; margin-bottom: 15px;">üéØ ËÆ≠ÁªÉÊåáÂçó</h3>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #007bff;">
                        <h4 style="color: #007bff; margin-bottom: 10px;">üìä Êï∞ÊçÆÂáÜÂ§áÂª∫ËÆÆ</h4>
                        <ul style="margin: 0; padding-left: 20px; color: #666; line-height: 1.8;">
                            <li><strong>Êï∞ÊçÆÈáèÔºö</strong>ÊØèÁ±ªËá≥Â∞ë20Âº†ÂõæÁâáÔºåË∂äÂ§öË∂äÂ•ΩÔºàÂª∫ËÆÆ15-20Âº†‰∏çÂêåËßíÂ∫¶„ÄÅÂÖâÁÖßÔºâ</li>
                            <li><strong>ÂõæÁâáË¥®ÈáèÔºö</strong>Ê∏ÖÊô∞„ÄÅÊ≠£Èù¢„ÄÅÂÖâÁ∫øÂÖÖË∂≥Ôºå‰∏ª‰ΩìÁ™ÅÂá∫ÔºåÈÅøÂÖçËÉåÊôØËøá‰∫éÂ§çÊùÇ</li>
                            <li><strong>Á±ªÂà´Âπ≥Ë°°Ôºö</strong>ÊØè‰∏™Á±ªÂà´ÁöÑÂõæÁâáÊï∞ÈáèÂ∞ΩÈáèÁõ∏ÂêåÔºåÈÅøÂÖçÊï∞ÊçÆÂÄæÊñú</li>
                            <li><strong>Êï∞ÊçÆÂ¢ûÂº∫Ôºö</strong>Â∑≤ÂêØÁî®ÁøªËΩ¨Âíå‰∫ÆÂ∫¶Ë∞ÉÊï¥ÔºåÊï∞ÊçÆÈáèÂ∞ÜËá™Âä®Êâ©Â§ß3ÂÄç</li>
                            <li><strong>ËÆ≠ÁªÉÊó∂Èó¥Ôºö</strong>ÂèñÂÜ≥‰∫éÂõæÁâáÊï∞ÈáèÔºåÊØèÁ±ª20Âº†ÂõæÁâáÁ∫¶ÈúÄ3-5ÂàÜÈíü</li>
                        </ul>
                    </div>
                </div>

            <!-- Ê≠•È™§1ÔºöÂàõÂª∫ÂàÜÁ±ª -->
            <div class="step-section">
                <div class="step-title">
                    <div class="step-number">1</div>
                    <span>ÂàõÂª∫ÂàÜÁ±ªÁ±ªÂà´</span>
                </div>
                <p>‰∏∫‰Ω†ÁöÑAIÊ®°ÂûãÂàõÂª∫ÂàÜÁ±ªÁ±ªÂà´„ÄÇ‰æãÂ¶ÇÔºöÁå´„ÄÅÁãó„ÄÅÊ±ΩËΩ¶Á≠â</p>
                <button class="add-class-btn" onclick="addClass()">‚ûï Ê∑ªÂä†Êñ∞Á±ªÂà´</button>
                <div class="classes-container" id="classesContainer">
                    <div class="class-card" data-class="0">
                        <div class="class-header">
                            <input type="text" class="class-name" value="Á±ªÂà´1" placeholder="ËæìÂÖ•Á±ªÂà´ÂêçÁß∞">
                            <button class="remove-class-btn" onclick="removeClass(0)">Âà†Èô§</button>
                        </div>
                        <div class="image-stats">Â∑≤‰∏ä‰º†: <span class="image-count">0</span> Âº†ÂõæÁâá</div>
                        <div class="image-upload" onclick="uploadImages(0)">
                            <div class="upload-icon">üì∏</div>
                            <p>ÁÇπÂáªÊàñÊãñÊãΩÂõæÁâáÂà∞Ê≠§Â§Ñ</p>
                            <input type="file" class="file-input" multiple accept="image/*" onchange="handleFileSelect(event, 0)">
                        </div>
                        <div class="image-preview" id="preview0"></div>
                    </div>
                    
                    <div class="class-card" data-class="1">
                        <div class="class-header">
                            <input type="text" class="class-name" value="Á±ªÂà´2" placeholder="ËæìÂÖ•Á±ªÂà´ÂêçÁß∞">
                            <button class="remove-class-btn" onclick="removeClass(1)">Âà†Èô§</button>
                        </div>
                        <div class="image-stats">Â∑≤‰∏ä‰º†: <span class="image-count">0</span> Âº†ÂõæÁâá</div>
                        <div class="image-upload" onclick="uploadImages(1)">
                            <div class="upload-icon">üì∏</div>
                            <p>ÁÇπÂáªÊàñÊãñÊãΩÂõæÁâáÂà∞Ê≠§Â§Ñ</p>
                            <input type="file" class="file-input" multiple accept="image/*" onchange="handleFileSelect(event, 1)">
                        </div>
                        <div class="image-preview" id="preview1"></div>
                    </div>
                </div>
            </div>
            
            <!-- Ê≠•È™§2ÔºöËÆ≠ÁªÉÊ®°Âûã -->
            <div class="step-section">
                <div class="step-title">
                    <div class="step-number">2</div>
                    <span>ËøÅÁßªÂ≠¶‰π†ËÆ≠ÁªÉ</span>
                </div>
                <div class="training-section">
                    <div class="training-details">
                        <strong>üß† ‰ΩøÁî®ÊäÄÊúØÔºö</strong><br>
                        ‚Ä¢ È¢ÑËÆ≠ÁªÉÊ®°ÂûãÔºöMobileNet v2 (1280Áª¥ÁâπÂæÅ)<br>
                        ‚Ä¢ ÂàÜÁ±ªÂô®ÔºöËá™ÂÆö‰πâÂÖ®ËøûÊé•Â±Ç<br>
                        ‚Ä¢ ‰ºòÂåñÂô®ÔºöAdam (Â≠¶‰π†Áéá: 0.0001)<br>
                        ‚Ä¢ ÊçüÂ§±ÂáΩÊï∞ÔºöÂàÜÁ±ª‰∫§ÂèâÁÜµ<br>
                        ‚Ä¢ ËÆ≠ÁªÉÊñπÂºèÔºöÊµèËßàÂô®Êú¨Âú∞ËÆ≠ÁªÉ<br>
                        ‚Ä¢ Ê®°ÂûãÂä†ËΩΩÔºöÊú¨Âú∞‰ºòÂÖàÔºåCDNÂõûÈÄÄ
                    </div>
                    
                    
                    
                    <button class="train-btn" id="trainBtn" onclick="trainModel()">üöÄ ÂºÄÂßãÁúüÂÆûËÆ≠ÁªÉ</button>
                    <button class="train-btn" onclick="resetModel()" style="background: #ff4757;">üîÑ ÈáçÁΩÆÊ®°Âûã</button>
                    
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="status-message" id="statusMessage">Á≠âÂæÖËÆ≠ÁªÉÂºÄÂßã...</div>
                    </div>
                    
                    <div class="model-metrics" id="modelMetrics" style="display: none;">
                        <div class="metric-card">
                            <div>ÂáÜÁ°ÆÁéá</div>
                            <div class="metric-value" id="accuracy">0%</div>
                        </div>
                        <div class="metric-card">
                            <div>ËÆ≠ÁªÉËΩÆÊï∞</div>
                            <div class="metric-value" id="epochs">0/100</div>
                        </div>
                        <div class="metric-card">
                            <div>ÊçüÂ§±ÂÄº</div>
                            <div class="metric-value" id="loss">0.00</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ê≠•È™§3ÔºöÊµãËØïÊ®°Âûã -->
            <div class="step-section">
                <div class="step-title">
                    <div class="step-number">3</div>
                    <span>ÊµãËØï‰Ω†ÁöÑ‰∏ì‰∏öAIÊ®°Âûã</span>
                </div>
                <div class="prediction-section" id="predictionSection">
                    <p>‰∏ä‰º†‰∏ÄÂº†Êñ∞ÂõæÁâáÔºå‰ΩìÈ™å‰∏ì‰∏öÁ∫ßÁöÑAIÂàÜÁ±ªÊïàÊûúÔºÅ</p>
                    <div class="test-upload">
                        <div class="image-upload" onclick="uploadTestImage()">
                            <div class="upload-icon">üîç</div>
                            <p>‰∏ä‰º†ÊµãËØïÂõæÁâá</p>
                            <input type="file" class="file-input" accept="image/*" onchange="handleTestFile(event)">
                        </div>
                    </div>
                    <div class="test-preview" id="testPreview">
                        <img id="testImage" alt="ÊµãËØïÂõæÁâá">
                    </div>
                    <div class="prediction-result" id="predictionResult">
                        <div style="text-align: center; color: #666; font-size: 1.2em;">
                            <p>üéØ ‰∏ä‰º†ÂõæÁâáÂêéÔºåËøôÈáåÂ∞ÜÊòæÁ§∫AIÁöÑ‰∏ì‰∏öÈ¢ÑÊµãÁªìÊûúÔºÅ</p>
                            <p>ÊØè‰∏™Á±ªÂà´ÈÉΩ‰ºöÊòæÁ§∫ÁΩÆ‰ø°Â∫¶ÂíåÊ¶ÇÁéáÊù°</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let mobilenetModel;
        let customModel;
        let classes = [];
        let trainingData = [];
        let classCount = 2;
        let isTraining = false;

        // ÂàùÂßãÂåñ
        async function init() {
            console.log('Ê≠£Âú®Âä†ËΩΩ‰∏ì‰∏öÁ∫ßÈ¢ÑËÆ≠ÁªÉÊ®°Âûã...');
            document.getElementById('statusMessage').textContent = 'Ê≠£Âú®Âä†ËΩΩMobileNetÊ®°Âûã...';
            
            try {
                // ËÆæÁΩÆË∂ÖÊó∂Êó∂Èó¥
                const timeoutPromise = new Promise((_, reject) => 
                    setTimeout(() => reject(new Error('Âä†ËΩΩË∂ÖÊó∂')), 30000)
                );
                
                // Â∞ùËØïÂ§öÁßçÂä†ËΩΩÊñπÂºèÔºöÊú¨Âú∞ -> CDN
                mobilenetModel = await Promise.race([
                    loadModelWithFallback(),
                    timeoutPromise
                ]);
                
                console.log('MobileNetÊ®°ÂûãÂä†ËΩΩÊàêÂäüÔºÅ');
                document.getElementById('statusMessage').textContent = 'Ê®°ÂûãÂ∑≤Â∞±Áª™ÔºåËØ∑‰∏ä‰º†ÂõæÁâáÂºÄÂßãËÆ≠ÁªÉÔºÅ';
                
                // È¢ÑÁÉ≠Ê®°Âûã
                const dummyTensor = tf.zeros([1, 224, 224, 3]);
                await mobilenetModel.infer(dummyTensor, 'conv_preds');
                dummyTensor.dispose();
                
            } catch (error) {
                console.error('Ê®°ÂûãÂä†ËΩΩÂ§±Ë¥•:', error);
                handleModelLoadError(error);
            }
        }

        // Êô∫ËÉΩÊ®°ÂûãÂä†ËΩΩÔºàÊú¨Âú∞‰ºòÂÖàÔºåCDNÂõûÈÄÄÔºâ
        async function loadModelWithFallback() {
            const loadingMethods = [
                // ÊñπÊ≥ï1ÔºöÊú¨Âú∞Ê®°Âûã
                async () => {
                    console.log('Â∞ùËØïÂä†ËΩΩÊú¨Âú∞MobileNetÊ®°Âûã...');
                    try {
                        return await mobilenet.load({
                            modelUrl: './models/mobilenet_v2/model.json'
                        });
                    } catch (localError) {
                        console.log('Êú¨Âú∞Ê®°ÂûãÊú™ÊâæÂà∞ÔºåÂ∞ùËØïCDN...');
                        throw localError;
                    }
                },
                // ÊñπÊ≥ï2ÔºöCDNÂä†ËΩΩ
                async () => {
                    console.log('Âä†ËΩΩCDN MobileNetÊ®°Âûã...');
                    return await mobilenet.load();
                }
            ];

            // ‰æùÊ¨°Â∞ùËØïÊØèÁßçÂä†ËΩΩÊñπÂºè
            for (const method of loadingMethods) {
                try {
                    return await method();
                } catch (error) {
                    console.warn('Âä†ËΩΩÊñπÂºèÂ§±Ë¥•:', error.message);
                    if (method === loadingMethods[loadingMethods.length - 1]) {
                        throw error;
                    }
                }
            }
        }

        // ÈîôËØØÂ§ÑÁêÜ
        function handleModelLoadError(error) {
            let errorMessage = '';
            let solution = '';
            
            if (error.message.includes('timeout')) {
                errorMessage = 'Âä†ËΩΩË∂ÖÊó∂ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúÈÄüÂ∫¶';
                solution = 'Âª∫ËÆÆ‰ΩøÁî®Êú¨Âú∞Ê®°ÂûãÊàñÊ£ÄÊü•ÁΩëÁªúËøûÊé•';
            } else if (error.message.includes('fetch')) {
                errorMessage = 'ÁΩëÁªúËøûÊé•ÈóÆÈ¢òÔºåÊó†Ê≥ïËÆøÈóÆÊ®°ÂûãÊñá‰ª∂';
                solution = 'Â∑≤‰∏∫ÊÇ®ÂêØÁî®Êú¨Âú∞Ê®°ÂûãÂ§á‰ªΩÊñπÊ°à';
            } else if (error.message.includes('404') || error.message.includes('not found')) {
                errorMessage = 'Ê®°ÂûãÊñá‰ª∂Êú™ÊâæÂà∞';
                solution = 'ËØ∑‰∏ãËΩΩÊú¨Âú∞Ê®°ÂûãÊñá‰ª∂ÊàñÁ°Æ‰øùÁΩëÁªúËøûÊé•Ê≠£Â∏∏';
            } else {
                errorMessage = 'Êú™Áü•ÈîôËØØÔºö' + error.message;
                solution = 'ËØ∑Ê£ÄÊü•ÊµèËßàÂô®ÊéßÂà∂Âè∞Ëé∑ÂèñËØ¶ÁªÜ‰ø°ÊÅØ';
            }
            
            document.getElementById('statusMessage').innerHTML = `
                <div style="color: #ff4757; font-weight: bold; margin-bottom: 15px;">
                    ‚ùå Ê®°ÂûãÂä†ËΩΩÂ§±Ë¥•Ôºö${errorMessage}
                </div>
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                    <h4 style="color: #856404; margin-bottom: 10px;">üîß Ëß£ÂÜ≥ÊñπÊ°à</h4>
                    <p style="margin: 0 0 10px 0; color: #856404;"><strong>${solution}</strong></p>
                    <ul style="margin: 0; padding-left: 20px; color: #856404; line-height: 1.6;">
                        <li><strong>Êú¨Âú∞Ê®°ÂûãÔºö</strong>Â∑≤ÈÖçÁΩÆÊú¨Âú∞Ê®°ÂûãË∑ØÂæÑ ./models/mobilenet_v2/</li>
                        <li><strong>ÁΩëÁªúÊ£ÄÊü•Ôºö</strong>Á°ÆËÆ§ÂèØ‰ª•ËÆøÈóÆÂ§ñÁΩë</li>
                        <li><strong>Âà∑Êñ∞È°µÈù¢Ôºö</strong>Êåâ Ctrl+F5 Âº∫Âà∂Âà∑Êñ∞ÊµèËßàÂô®ÁºìÂ≠ò</li>
                        <li><strong>ÊµèËßàÂô®Ôºö</strong>‰ΩøÁî®ChromeÊàñEdgeÊúÄÊñ∞ÁâàÊú¨</li>
                    </ul>
                </div>
                <div style="margin-top: 15px; font-size: 0.9em; color: #666;">
                    <strong>ÊäÄÊúØ‰ø°ÊÅØÔºö</strong><br>
                    ÈîôËØØÁ±ªÂûãÔºö${error.name}<br>
                    ÈîôËØØËØ¶ÊÉÖÔºö${error.message.substring(0, 100)}...
                </div>
            `;
            
            // Á¶ÅÁî®ËÆ≠ÁªÉÊåâÈíÆ
            document.getElementById('trainBtn').disabled = true;
            document.getElementById('trainBtn').style.opacity = '0.5';
            document.getElementById('trainBtn').textContent = 'Ê®°ÂûãÊú™Âä†ËΩΩ';
            
            // Ê∑ªÂä†ÈáçËØïÊåâÈíÆ
            const retryBtn = document.createElement('button');
            retryBtn.textContent = 'üîÑ ÈáçÊñ∞Âä†ËΩΩÊ®°Âûã';
            retryBtn.style.cssText = 'background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;';
            retryBtn.onclick = () => {
                document.getElementById('statusMessage').textContent = 'Ê≠£Âú®ÈáçÊñ∞Âä†ËΩΩ...';
                setTimeout(init, 1000);
            };
            
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.appendChild(document.createElement('br'));
            statusDiv.appendChild(retryBtn);
        }

        // ÂàõÂª∫Â¢ûÂº∫ÁöÑËá™ÂÆö‰πâÂàÜÁ±ªÊ®°Âûã
        function createModel(numClasses) {
            const model = tf.sequential({
                layers: [
                    tf.layers.dense({
                        units: 512,
                        activation: 'relu',
                        kernelInitializer: 'varianceScaling',
                        useBias: true,
                        inputShape: [1024]
                    }),
                    tf.layers.batchNormalization(),
                    tf.layers.dropout({ rate: 0.3 }),
                    tf.layers.dense({
                        units: 256,
                        activation: 'relu',
                        kernelInitializer: 'varianceScaling',
                        useBias: true
                    }),
                    tf.layers.batchNormalization(),
                    tf.layers.dropout({ rate: 0.3 }),
                    tf.layers.dense({
                        units: 128,
                        activation: 'relu',
                        kernelInitializer: 'varianceScaling',
                        useBias: true
                    }),
                    tf.layers.dropout({ rate: 0.2 }),
                    tf.layers.dense({
                        units: numClasses,
                        activation: 'softmax',
                        kernelInitializer: 'varianceScaling',
                        useBias: true
                    })
                ]
            });

            model.compile({
                optimizer: tf.train.adam(0.0001),
                loss: 'categoricalCrossentropy',
                metrics: ['accuracy']
            });

            return model;
        }

        // Êï∞ÊçÆÂ¢ûÂº∫Ôºö‰ªÖ‰øùÁïôÁÆÄÂçïÁöÑÈöèÊú∫ÁøªËΩ¨
         function augmentImage(imgElement) {
             return tf.tidy(() => {
                 let tensor = tf.browser.fromPixels(imgElement)
                     .resizeNearestNeighbor([224, 224])
                     .toFloat()
                     .div(255.0)
                     .expandDims(0);
 
                 // ÈöèÊú∫Ê∞¥Âπ≥ÁøªËΩ¨ÔºàÁÆÄÂçï‰∏îÊúâÊïàÔºâ
                 if (Math.random() > 0.5) {
                     tensor = tensor.reverse(2);
                 }
 
                 // ÈöèÊú∫ÂûÇÁõ¥ÁøªËΩ¨
                 if (Math.random() > 0.5) {
                     tensor = tensor.reverse(1);
                 }
 
                 // ÈöèÊú∫‰∫ÆÂ∫¶Ë∞ÉÊï¥ÔºàËΩªÂæÆÂèòÂåñÔºâ
                 if (Math.random() > 0.5) {
                     const brightness = 0.9 + Math.random() * 0.2; // 0.9-1.1ÂÄç
                     tensor = tensor.mul(brightness).clipByValue(0, 1);
                 }
 
                 return tensor;
             });
         }

        // È¢ÑÂ§ÑÁêÜÂõæÁâáÔºàÊó†Â¢ûÂº∫Ôºâ
        function preprocessImage(imgElement) {
            return tf.tidy(() => {
                const tensor = tf.browser.fromPixels(imgElement)
                    .resizeNearestNeighbor([224, 224])
                    .toFloat()
                    .div(255.0)
                    .expandDims(0);
                const features = mobilenetModel.infer(tensor, 'conv_preds');
                return features.squeeze();
            });
        }

        // Ê∑ªÂä†Êñ∞Á±ªÂà´
        function addClass() {
            const container = document.getElementById('classesContainer');
            const newClass = document.createElement('div');
            newClass.className = 'class-card';
            newClass.setAttribute('data-class', classCount);
            newClass.innerHTML = `
                <div class="class-header">
                    <input type="text" class="class-name" value="Á±ªÂà´${classCount + 1}" placeholder="ËæìÂÖ•Á±ªÂà´ÂêçÁß∞">
                    <button class="remove-class-btn" onclick="removeClass(${classCount})">Âà†Èô§</button>
                </div>
                <div class="image-stats">Â∑≤‰∏ä‰º†: <span class="image-count">0</span> Âº†ÂõæÁâá</div>
                <div class="image-upload" onclick="uploadImages(${classCount})">
                    <div class="upload-icon">üì∏</div>
                    <p>ÁÇπÂáªÊàñÊãñÊãΩÂõæÁâáÂà∞Ê≠§Â§Ñ</p>
                    <input type="file" class="file-input" multiple accept="image/*" onchange="handleFileSelect(event, ${classCount})">
                </div>
                <div class="image-preview" id="preview${classCount}"></div>
            `;
            container.appendChild(newClass);
            classCount++;
            setupDragDrop();
        }

        // Âà†Èô§Á±ªÂà´
        function removeClass(index) {
            if (document.querySelectorAll('.class-card').length <= 2) {
                alert('Ëá≥Â∞ëÈúÄË¶Å‰øùÁïô‰∏§‰∏™Á±ªÂà´ÔºÅ');
                return;
            }
            const card = document.querySelector(`[data-class="${index}"]`);
            card.remove();
        }

        // ‰∏ä‰º†ÂõæÁâá
        function uploadImages(classIndex) {
            document.querySelector(`[data-class="${classIndex}"] .file-input`).click();
        }

        // Â§ÑÁêÜÊñá‰ª∂ÈÄâÊã©
        async function handleFileSelect(event, classIndex) {
            const files = Array.from(event.target.files);
            const preview = document.getElementById(`preview${classIndex}`);
            const imageCount = preview.querySelectorAll('.preview-item').length;
            
            for (const file of files) {
                if (file.type.startsWith('image/')) {
                    const img = new Image();
                    img.onload = function() {
                        const previewItem = document.createElement('div');
                        previewItem.className = 'preview-item';
                        previewItem.innerHTML = `
                            <img src="${URL.createObjectURL(file)}" alt="È¢ÑËßà">
                            <button class="remove-btn" onclick="this.parentElement.remove(); updateImageCount(${classIndex})">√ó</button>
                        `;
                        preview.appendChild(previewItem);
                        updateImageCount(classIndex);
                    };
                    img.src = URL.createObjectURL(file);
                }
            }
        }

        // Êõ¥Êñ∞ÂõæÁâáËÆ°Êï∞
        function updateImageCount(classIndex) {
            const card = document.querySelector(`[data-class="${classIndex}"]`);
            const count = card.querySelectorAll('.preview-item').length;
            card.querySelector('.image-count').textContent = count;
        }

        // ËÆæÁΩÆÊãñÊãΩ‰∏ä‰º†
        function setupDragDrop() {
            document.querySelectorAll('.image-upload').forEach(upload => {
                upload.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('dragover');
                });
                
                upload.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                });
                
                upload.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                    
                    const files = Array.from(e.dataTransfer.files);
                    const classIndex = this.closest('.class-card').getAttribute('data-class');
                    const preview = document.getElementById(`preview${classIndex}`);
                    
                    files.forEach(file => {
                        if (file.type.startsWith('image/')) {
                            const img = new Image();
                            img.onload = function() {
                                const previewItem = document.createElement('div');
                                previewItem.className = 'preview-item';
                                previewItem.innerHTML = `
                                    <img src="${URL.createObjectURL(file)}" alt="È¢ÑËßà">
                                    <button class="remove-btn" onclick="this.parentElement.remove(); updateImageCount(${classIndex})">√ó</button>
                                `;
                                preview.appendChild(previewItem);
                                updateImageCount(classIndex);
                            };
                            img.src = URL.createObjectURL(file);
                        }
                    });
                });
            });
        }

        // ËÆ≠ÁªÉÊ®°Âûã
        async function trainModel() {
            if (isTraining) return;
            
            const classCards = document.querySelectorAll('.class-card');
            let totalImages = 0;
            trainingData = [];
            classes = [];
            
            // Êî∂ÈõÜËÆ≠ÁªÉÊï∞ÊçÆ
            for (const card of classCards) {
                const classIndex = parseInt(card.getAttribute('data-class'));
                const className = card.querySelector('.class-name').value;
                const images = card.querySelectorAll('.preview-item img');
                
                if (images.length < 8) {
                    alert(`Á±ªÂà´ "${className}" Ëá≥Â∞ëÈúÄË¶Å8Âº†ÂõæÁâáÔºÅ`);
                    return;
                }
                
                classes.push({ index: classIndex, name: className });
                
                for (const img of images) {
                    trainingData.push({
                        image: img,
                        label: classIndex,
                        className: className
                    });
                    totalImages++;
                }
            }
            
            if (classes.length < 2) {
                alert('Ëá≥Â∞ëÈúÄË¶Å‰∏§‰∏™Á±ªÂà´ÔºÅ');
                return;
            }
            
            console.log(`ÂºÄÂßãËÆ≠ÁªÉ - Á±ªÂà´Êï∞: ${classes.length}, ÊÄªÂõæÁâáÊï∞: ${totalImages}, Â¢ûÂº∫ÂêéÊ†∑Êú¨Êï∞: ${totalImages * 3}`);
            const startTime = Date.now();
            
            // ËÆ≠ÁªÉÂâçÊ£ÄÊü•ÂíåÊèêÁ§∫
            const originalImages = trainingData.length;
            const augmentedImages = originalImages * 3;
            
            let timeEstimate = "‚ö° Âø´ÈÄüËÆ≠ÁªÉ";
            let warning = "";
            
            if (originalImages < 20) {
                timeEstimate = "‚ö° Ë∂ÖÂø´ËÆ≠ÁªÉ";
                warning = "‚ö†Ô∏è Êï∞ÊçÆÈáèËæÉÂ∞ëÔºåËÆ≠ÁªÉ‰ºöÈùûÂ∏∏Âø´Ôºå‰ΩÜÂèØËÉΩÂΩ±ÂìçÂáÜÁ°ÆÊÄß";
            } else if (originalImages < 50) {
                timeEstimate = "üöÄ Ê≠£Â∏∏ËÆ≠ÁªÉ";
                warning = "‚úÖ Êï∞ÊçÆÈáèÈÄÇ‰∏≠ÔºåËÆ≠ÁªÉÊó∂Èó¥Ê≠£Â∏∏";
            } else {
                timeEstimate = "‚è≥ Ê∑±Â∫¶ËÆ≠ÁªÉ";
                warning = "üî• Êï∞ÊçÆÈáèÂÖÖË∂≥ÔºåËÆ≠ÁªÉÊó∂Èó¥ËæÉÈïø‰ΩÜÊïàÊûúÊõ¥Â•Ω";
            }
            
            const estimatedTotalTime = Math.max(3, Math.ceil(augmentedImages * 0.05));
            
            console.log(`${timeEstimate} - ${warning}`);
            console.log(`È¢ÑËÆ°ÊÄªËÆ≠ÁªÉÊó∂Èó¥: ${estimatedTotalTime}-${estimatedTotalTime * 2}Áßí`);
            
            isTraining = true;
            document.getElementById('trainBtn').disabled = true;
            document.getElementById('statusMessage').textContent = 
                `${timeEstimate} - ${warning} È¢ÑËÆ°${estimatedTotalTime}-${estimatedTotalTime * 2}Áßí`;
            document.getElementById('modelMetrics').style.display = 'grid';
            
            try {
                // ÂàõÂª∫Ê®°Âûã
                customModel = createModel(classes.length);
                
                // ÂáÜÂ§áËÆ≠ÁªÉÊï∞ÊçÆ
                const { xs, ys } = await prepareTrainingData();
                
                // ËÆ≠ÁªÉÊ®°Âûã
                await trainCustomModel(xs, ys);
                
                const endTime = Date.now();
                const trainingTime = ((endTime - startTime) / 1000).toFixed(1);
                
                document.getElementById('predictionSection').style.display = 'block';
                document.getElementById('statusMessage').textContent = `ËÆ≠ÁªÉÂÆåÊàêÔºÅÂÆûÈôÖËÆ≠ÁªÉÊó∂Èó¥: ${trainingTime}Áßí`;
                console.log(`ËÆ≠ÁªÉÂÆåÊàê - ÂÆûÈôÖÁî®Êó∂: ${trainingTime}Áßí`);
                
            } catch (error) {
                console.error('ËÆ≠ÁªÉÂ§±Ë¥•:', error);
                document.getElementById('statusMessage').textContent = 'ËÆ≠ÁªÉÂ§±Ë¥•: ' + error.message;
            } finally {
                isTraining = false;
                document.getElementById('trainBtn').disabled = false;
            }
        }

        // ÂáÜÂ§áËÆ≠ÁªÉÊï∞ÊçÆÔºàÂ∏¶Â¢ûÂº∫Ôºâ
        async function prepareTrainingData() {
            const statusMessage = document.getElementById('statusMessage');
            
            const xs = [];
            const ys = [];
            
            // ÊØèÂº†ÁÖßÁâáÁîüÊàê3‰∏™Â¢ûÂº∫ÁâàÊú¨
            const augmentFactor = 3;
            const totalSteps = trainingData.length * augmentFactor;
            
            // Êï∞ÊçÆÈáèÊ£ÄÊü•ÂíåÊó∂Èó¥È¢Ñ‰º∞
            const originalImages = trainingData.length;
            const augmentedImages = originalImages * augmentFactor;
            const estimatedFeatureTime = Math.ceil(originalImages * 0.2);
            const estimatedAugmentTime = Math.ceil(augmentedImages * 0.1);
            
            console.log(`Êï∞ÊçÆÂáÜÂ§áÂºÄÂßã - ÂéüÂßãÂõæÁâá: ${originalImages}, Â¢ûÂº∫Âêé: ${augmentedImages}`);
            console.log(`È¢ÑËÆ°ÁâπÂæÅÊèêÂèñÊó∂Èó¥: ${estimatedFeatureTime}Áßí, Êï∞ÊçÆÂ¢ûÂº∫Êó∂Èó¥: ${estimatedAugmentTime}Áßí`);
            
            statusMessage.textContent = `Ê≠£Âú®ÊèêÂèñÁâπÂæÅ... È¢ÑËÆ°ÈúÄË¶Å ${estimatedFeatureTime + estimatedAugmentTime}Áßí`;
            
            let step = 0;
            
            for (const data of trainingData) {
                // ÂéüÂßãÂõæÁâá
                const features = preprocessImage(data.image);
                xs.push(features.expandDims(0));
                const label = tf.tidy(() => tf.oneHot([data.label], classes.length));
                ys.push(label);
                
                // Â¢ûÂº∫ÁâàÊú¨ - Â¢ûÂä†Âª∂ËøüËÆ©ËøáÁ®ãÊõ¥ÊòéÊòæ
                for (let aug = 0; aug < augmentFactor - 1; aug++) {
                    const augTensor = augmentImage(data.image);
                    const augFeatures = mobilenetModel.infer(augTensor, 'conv_preds').squeeze();
                    xs.push(augFeatures.expandDims(0));
                    ys.push(label);
                    
                    step++;
                    const progress = (step / totalSteps) * 100;
                    document.getElementById('progressFill').style.width = `${progress * 0.3}%`;
                    
                    // Â¢ûÂä†Âª∂ËøüËÆ©Áî®Êà∑ÁúãÂà∞ËøáÁ®ã
                    await new Promise(resolve => setTimeout(resolve, 50 + Math.random() * 100));
                    
                    // Ê∏ÖÁêÜ‰∏≠Èó¥Âº†Èáè
                    augTensor.dispose();
                }
                
                step++;
                const progress = (step / totalSteps) * 100;
                document.getElementById('progressFill').style.width = `${progress * 0.3}%`;
            }
            
            const xsTensor = tf.concat(xs, 0);
            const ysTensor = tf.concat(ys, 0);
            
            xs.forEach(x => x.dispose());
            ys.forEach(y => y.dispose());
            
            console.log(`Êï∞ÊçÆÂáÜÂ§áÂÆåÊàê - ÊúÄÁªàËÆ≠ÁªÉÊ†∑Êú¨: ${xsTensor.shape[0]}‰∏™`);
            return { xs: xsTensor, ys: ysTensor };
        }

        // ËÆ≠ÁªÉËá™ÂÆö‰πâÊ®°Âûã
        async function trainCustomModel(xs, ys) {
            const statusMessage = document.getElementById('statusMessage');
            const epochs = 100;
            
            console.log(`ÂºÄÂßãËÆ≠ÁªÉ - Ê†∑Êú¨Áª¥Â∫¶: ${xs.shape}, ÊâπÊ¨°Â§ßÂ∞è: ${Math.min(Math.floor(xs.shape[0] * 0.4), 32)}`);
            
            await customModel.fit(xs, ys, {
                epochs: epochs,
                batchSize: Math.min(Math.floor(xs.shape[0] * 0.4), 32),
                validationSplit: 0.2,
                callbacks: {
                    onEpochBegin: async (epoch) => {
                        if (epoch === 0) {
                            console.log(`Á¨¨1ËΩÆÂºÄÂßã - È¢ÑËÆ°ÊÄªÊó∂Èó¥: ${Math.ceil(epochs * 0.1)}-${Math.ceil(epochs * 0.3)}Áßí`);
                        }
                    },
                    onEpochEnd: async (epoch, logs) => {
                        const progress = 30 + ((epoch + 1) / epochs) * 70;
                        document.getElementById('progressFill').style.width = `${progress}%`;
                        document.getElementById('epochs').textContent = `${epoch + 1}/${epochs}`;
                        document.getElementById('loss').textContent = logs.loss.toFixed(3);
                        document.getElementById('accuracy').textContent = `${(logs.acc * 100).toFixed(1)}%`;
                        
                        const estimatedRemaining = ((epochs - epoch - 1) * 0.15).toFixed(1);
                        statusMessage.textContent = `ËÆ≠ÁªÉ‰∏≠... Á¨¨ ${epoch + 1}/${epochs} ËΩÆ (È¢ÑËÆ°Ââ©‰Ωô ${estimatedRemaining}Áßí)`;
                        
                        console.log(`Á¨¨${epoch + 1}ËΩÆ - ÊçüÂ§±: ${logs.loss.toFixed(4)}, ÂáÜÁ°ÆÁéá: ${(logs.acc * 100).toFixed(1)}%`);
                        
                        // Â¢ûÂä†Âª∂ËøüËÆ©Áî®Êà∑ÁúãÂà∞ËÆ≠ÁªÉËøáÁ®ã
                        await new Promise(resolve => setTimeout(resolve, 100 + Math.random() * 50));
                    }
                }
            });
            
            xs.dispose();
            ys.dispose();
        }

        // ÈáçÁΩÆÊ®°Âûã
        function resetModel() {
            if (confirm('Á°ÆÂÆöË¶ÅÈáçÁΩÆÊâÄÊúâËÆ≠ÁªÉÊï∞ÊçÆÂêóÔºüËøôÂ∞ÜÊ∏ÖÈô§ÊâÄÊúâËÆ≠ÁªÉÁªìÊûú„ÄÇ')) {
                if (customModel) {
                    customModel.dispose();
                    customModel = null;
                }
                
                document.querySelectorAll('.image-preview').forEach(preview => {
                    preview.innerHTML = '';
                });
                document.querySelectorAll('.image-count').forEach(count => {
                    count.textContent = '0';
                });
                document.getElementById('predictionSection').style.display = 'none';
                document.getElementById('statusMessage').textContent = 'Ê®°ÂûãÂ∑≤ÈáçÁΩÆÔºåËØ∑ÈáçÊñ∞‰∏ä‰º†ÂõæÁâá„ÄÇ';
                document.getElementById('progressFill').style.width = '0%';
                document.getElementById('modelMetrics').style.display = 'none';
            }
        }

        // ‰∏ä‰º†ÊµãËØïÂõæÁâá
        function uploadTestImage() {
            document.querySelector('#predictionSection .file-input').click();
        }

        // Â§ÑÁêÜÊµãËØïÊñá‰ª∂
        function handleTestFile(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const img = new Image();
                img.onload = function() {
                    const testPreview = document.getElementById('testPreview');
                    const testImage = document.getElementById('testImage');
                    testImage.src = URL.createObjectURL(file);
                    testPreview.style.display = 'block';
                    predictImage(img);
                };
                img.src = URL.createObjectURL(file);
            }
        }

        // È¢ÑÊµãÂõæÁâá
    async function predictImage(imgElement) {
        if (!customModel || !imgElement) {
            alert('ËØ∑ÂÖàËÆ≠ÁªÉÊ®°ÂûãÂπ∂‰∏ä‰º†ÊµãËØïÂõæÁâáÔºÅ');
            return;
        }

        try {
            const features = preprocessImage(imgElement);
            const predictions = customModel.predict(features.expandDims(0));
            const probs = await predictions.data();
            
            const results = classes.map((cls, index) => ({
                className: cls.name,
                confidence: probs[index]
            })).sort((a, b) => b.confidence - a.confidence);

            const predictionResult = document.getElementById('predictionResult');
            let html = '<h3>üéØ ‰∏ì‰∏öÈ¢ÑÊµãÁªìÊûú</h3><div class="prediction-result">';
            
            results.forEach((result, index) => {
                const percentage = Math.round(result.confidence * 100);
                const isWinner = index === 0;
                
                html += `
                        <div class="result-card ${isWinner ? 'winner' : ''}">
                            <h4>${result.className}</h4>
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${percentage}%"></div>
                            </div>
                            <p>${percentage}%</p>
                            ${isWinner ? '<div>üèÜ ÊúÄ‰Ω≥ÂåπÈÖç</div>' : ''}
                        </div>
                    `;
            });
            
            html += '</div>';
            html += `<div style="text-align: center; margin-top: 20px; font-size: 1.3em; color: #4CAF50; font-weight: bold;">
                üéâ AIÈ¢ÑÊµãÁªìÊûú: <span style="color: #FFD700;">${results[0].className}</span> ÁöÑÂèØËÉΩÊÄßÊúÄÈ´òÔºÅ
            </div>`;
            
            predictionResult.innerHTML = html;
            
            features.dispose();
            predictions.dispose();
        } catch (error) {
            console.error('È¢ÑÊµãÂá∫Èîô:', error);
            alert('È¢ÑÊµãËøáÁ®ã‰∏≠Âá∫Áé∞ÈîôËØØÔºåËØ∑Ê£ÄÊü•ÊéßÂà∂Âè∞Êó•Âøó');
        }
    }

        // ÂàùÂßãÂåñÈ°µÈù¢
        init();
        setupDragDrop();
    </script>
</body>
</html>